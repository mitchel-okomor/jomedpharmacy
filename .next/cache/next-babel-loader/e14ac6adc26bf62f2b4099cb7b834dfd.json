{"ast":null,"code":"import React from \"react\";\nvar __jsx = React.createElement;\nimport css from './admin.module.scss';\nimport { useEffect, useState } from \"react\";\nimport Link from 'next/link';\nimport axios from 'axios';\nimport Loading from '../components/loading';\nimport { useContext } from 'react';\nimport appContext from '../components/appcontext';\nimport { useRouter } from 'next/router';\n\nconst Admin = () => {\n  const router = useRouter();\n  const {\n    customer\n  } = useContext(appContext);\n  const {\n    0: products,\n    1: setProducts\n  } = useState([\"o\", \"p\"]);\n  const {\n    0: loading,\n    1: setLoading\n  } = useState(false);\n  const {\n    0: name,\n    1: setName\n  } = useState();\n  const {\n    0: description,\n    1: setDescription\n  } = useState();\n  const {\n    0: price,\n    1: setPrice\n  } = useState();\n  const {\n    0: category,\n    1: setCategory\n  } = useState();\n  const {\n    0: image,\n    1: setImage\n  } = useState();\n  const {\n    0: buttonText,\n    1: setButtonText\n  } = useState(\"Add product\");\n  useEffect(() => {\n    getProducts();\n  }, []);\n\n  const getProducts = async function () {\n    try {\n      const res = await fetch('http://localhost:4000/products');\n      const data = await res.json();\n      setProducts(data.data);\n    } catch {\n      console.log(\"Unable to load Products\");\n      setProducts(\"\");\n    }\n  };\n\n  const addButton = () => {\n    let elem = document.getElementsByClassName(\"admin_form\")[0];\n    elem.style.display === \"block\" ? elem.style.display = \"none\" : elem.style.display = \"block\";\n\n    if (buttonText === \"Add product\") {\n      setButtonText(\"Close\");\n    } else {\n      setButtonText(\"Add product\");\n    }\n  }; //get form values\n\n\n  const handleChange = e => {\n    console.log(e.target.value);\n\n    switch (e.target.name) {\n      case \"name\":\n        setName(e.target.value);\n        break;\n\n      case \"price\":\n        setPrice(e.target.value);\n        break;\n\n      case \"category\":\n        setCategory(e.target.value);\n        break;\n\n      case \"description\":\n        setDescription(e.target.value);\n        break;\n\n      case \"image\":\n        setImage(e.target.files[0]);\n    }\n\n    console.log(image);\n  }; //submit form data to backend server\n\n\n  const handleSubmit = async e => {\n    setLoading(true);\n    e.preventDefault();\n    var formData = new FormData();\n    formData.append(\"name\", name);\n    formData.append(\"price\", price);\n    formData.append(\"category\", category);\n    formData.append(\"description\", description);\n    formData.append(\"image\", image);\n    const url = 'http://localhost:4000/product';\n\n    try {\n      const response = await axios.post(url, formData, {\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        },\n        timeout: 30000\n      });\n\n      if (response.status == 200) {\n        console.log(response);\n        getProducts();\n        setLoading(false);\n      }\n    } catch (error) {\n      console.log(error);\n      setLoading(false);\n    }\n  };\n\n  const handleDelete = async id => {\n    console.log(id);\n    setLoading(true);\n    const url = 'http://localhost:4000/product/' + id;\n\n    try {\n      const response = await axios.delete(url, {\n        timeout: 90000\n      });\n\n      if (response.status == 200) {\n        console.log(response);\n        getProducts();\n        setLoading(false);\n      }\n    } catch (error) {\n      console.log(error);\n      setLoading(false);\n      alert(\"failed to delete\");\n    }\n  };\n\n  if (loading) {\n    return __jsx(Loading, null);\n  } else if (!customer || !Boolean(customer.is_admin)) {\n    if (false) {\n      router.push('/');\n    }\n  }\n\n  return __jsx(\"div\", {\n    className: css.admin\n  }, __jsx(\"h1\", {\n    className: css.admin_header\n  }, \"Admin Page\"), __jsx(\"div\", {\n    className: css.add_product\n  }, __jsx(\"button\", {\n    onClick: addButton\n  }, buttonText), __jsx(\"div\", null, __jsx(\"form\", {\n    className: css.show,\n    className: \"admin_form\"\n  }, __jsx(\"label\", {\n    for: \"name\"\n  }, \"Name:\"), __jsx(\"input\", {\n    type: \"text\",\n    id: \"name\",\n    name: \"name\",\n    placeholder: \"product name\",\n    value: name,\n    onChange: handleChange\n  }), __jsx(\"label\", {\n    for: \"price\"\n  }, \"Price:\"), __jsx(\"input\", {\n    type: \"text\",\n    id: \"price\",\n    name: \"price\",\n    placeholder: \"product price\",\n    value: price,\n    onChange: handleChange\n  }), __jsx(\"label\", {\n    for: \"category\"\n  }, \"category:\"), __jsx(\"select\", {\n    id: \"category\",\n    name: \"category\",\n    onChange: handleChange\n  }, __jsx(\"option\", {\n    value: \"antibiotics\",\n    selected: true\n  }, \"Antibiotics\"), __jsx(\"option\", {\n    value: \"antidiabetics\"\n  }, \"Antidiabetics\"), __jsx(\"option\", {\n    value: \"antimaleria\"\n  }, \"Antimaleria\")), __jsx(\"br\", null), __jsx(\"label\", {\n    for: \"image\"\n  }, \"Upload image:\"), __jsx(\"input\", {\n    type: \"file\",\n    id: \"image\",\n    name: \"image\",\n    placeholder: \"Select Image\",\n    onChange: handleChange\n  }), __jsx(\"label\", {\n    for: \"description\"\n  }, \"Description:\"), __jsx(\"textarea\", {\n    type: \"text\",\n    id: \"description\",\n    name: \"description\",\n    placeholder: \"Product Description\",\n    value: description,\n    onChange: handleChange\n  }), __jsx(\"br\", null), __jsx(\"button\", {\n    onClick: handleSubmit\n  }, \"Submit\")))), __jsx(\"table\", {\n    className: css.table\n  }, __jsx(\"thead\", null, __jsx(\"tr\", null, __jsx(\"th\", null, __jsx(\"div\", null, \"Product\")), __jsx(\"th\", null, __jsx(\"div\", null, \"Category\")), __jsx(\"th\", null, __jsx(\"div\", null, \"Price\")), __jsx(\"th\", null, __jsx(\"div\", null, \"In stock\")), __jsx(\"th\", null, __jsx(\"div\", null, \"Action\")))), __jsx(\"tbody\", null, products.map(item => __jsx(\"tr\", {\n    key: item.product_id\n  }, __jsx(\"td\", null, __jsx(\"div\", null, __jsx(\"img\", {\n    src: \"http://localhost:4000/\" + item.image_url,\n    alt: \"\",\n    width: \"40em\"\n  }), __jsx(\"br\", null), __jsx(Link, {\n    href: \"/products/[id]\",\n    as: `/products/${item.id}`\n  }, __jsx(\"a\", null, \" \", item.name)))), __jsx(\"td\", null, __jsx(\"strong\", null, item.category)), __jsx(\"td\", null, __jsx(\"strong\", null, \"\\u20A6 \", item.price)), __jsx(\"td\", null, item.quantity), __jsx(\"td\", null, __jsx(\"button\", null, __jsx(Link, {\n    href: \"/editproduct/[id]\",\n    as: `/editproduct/${item.product_id}`\n  }, \"Edit\")), __jsx(\"button\", {\n    onClick: () => {\n      handleDelete(item.product_id);\n    }\n  }, \"Delete\")))))));\n};\n\nexport default Admin;","map":null,"metadata":{},"sourceType":"module"}