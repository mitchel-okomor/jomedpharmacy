{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport css from './admin.module.scss';\nimport { useEffect, useState } from \"react\";\nimport Link from 'next/link';\nimport axios from 'axios';\nimport Loading from '../components/loading';\nimport { useContext } from 'react';\nimport appContext from '../components/appcontext';\nimport { useRouter } from 'next/router';\n\nvar Admin = function Admin() {\n  var router = useRouter();\n\n  var _useContext = useContext(appContext),\n      customer = _useContext.customer;\n\n  var _useState = useState([\"o\", \"p\"]),\n      products = _useState[0],\n      setProducts = _useState[1];\n\n  var _useState2 = useState(false),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  var _useState3 = useState(),\n      name = _useState3[0],\n      setName = _useState3[1];\n\n  var _useState4 = useState(),\n      description = _useState4[0],\n      setDescription = _useState4[1];\n\n  var _useState5 = useState(),\n      price = _useState5[0],\n      setPrice = _useState5[1];\n\n  var _useState6 = useState(),\n      category = _useState6[0],\n      setCategory = _useState6[1];\n\n  var _useState7 = useState(),\n      image = _useState7[0],\n      setImage = _useState7[1];\n\n  var _useState8 = useState(\"Add product\"),\n      buttonText = _useState8[0],\n      setButtonText = _useState8[1];\n\n  useEffect(function () {\n    getProducts();\n  }, []);\n\n  var getProducts = function getProducts() {\n    var res, data;\n    return _regeneratorRuntime.async(function getProducts$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            _context.next = 3;\n            return _regeneratorRuntime.awrap(fetch('http://localhost:4000/products'));\n\n          case 3:\n            res = _context.sent;\n            _context.next = 6;\n            return _regeneratorRuntime.awrap(res.json());\n\n          case 6:\n            data = _context.sent;\n            setProducts(data.data);\n            _context.next = 14;\n            break;\n\n          case 10:\n            _context.prev = 10;\n            _context.t0 = _context[\"catch\"](0);\n            console.log(\"Unable to load Products\");\n            setProducts(\"\");\n\n          case 14:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[0, 10]], Promise);\n  };\n\n  var addButton = function addButton() {\n    var elem = document.getElementsByClassName(\"admin_form\")[0];\n    elem.style.display === \"block\" ? elem.style.display = \"none\" : elem.style.display = \"block\";\n\n    if (buttonText === \"Add product\") {\n      setButtonText(\"Close\");\n    } else {\n      setButtonText(\"Add product\");\n    }\n  }; //get form values\n\n\n  var handleChange = function handleChange(e) {\n    console.log(e.target.value);\n\n    switch (e.target.name) {\n      case \"name\":\n        setName(e.target.value);\n        break;\n\n      case \"price\":\n        setPrice(e.target.value);\n        break;\n\n      case \"category\":\n        setCategory(e.target.value);\n        break;\n\n      case \"description\":\n        setDescription(e.target.value);\n        break;\n\n      case \"image\":\n        setImage(e.target.files[0]);\n    }\n\n    console.log(image);\n  }; //submit form data to backend server\n\n\n  var handleSubmit = function handleSubmit(e) {\n    var formData, url, response;\n    return _regeneratorRuntime.async(function handleSubmit$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            setLoading(true);\n            e.preventDefault();\n            formData = new FormData();\n            formData.append(\"name\", name);\n            formData.append(\"price\", price);\n            formData.append(\"category\", category);\n            formData.append(\"description\", description);\n            formData.append(\"image\", image);\n            url = 'http://localhost:4000/product';\n            _context2.prev = 9;\n            _context2.next = 12;\n            return _regeneratorRuntime.awrap(axios.post(url, formData, {\n              headers: {\n                'Content-Type': 'multipart/form-data'\n              },\n              timeout: 30000\n            }));\n\n          case 12:\n            response = _context2.sent;\n\n            if (response.status == 200) {\n              console.log(response);\n              getProducts();\n              setLoading(false);\n            }\n\n            _context2.next = 20;\n            break;\n\n          case 16:\n            _context2.prev = 16;\n            _context2.t0 = _context2[\"catch\"](9);\n            console.log(_context2.t0);\n            setLoading(false);\n\n          case 20:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, [[9, 16]], Promise);\n  };\n\n  var handleDelete = function handleDelete(id) {\n    var url, response;\n    return _regeneratorRuntime.async(function handleDelete$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            console.log(id);\n            setLoading(true);\n            url = 'http://localhost:4000/product/' + id;\n            _context3.prev = 3;\n            _context3.next = 6;\n            return _regeneratorRuntime.awrap(axios[\"delete\"](url, {\n              timeout: 90000\n            }));\n\n          case 6:\n            response = _context3.sent;\n\n            if (response.status == 200) {\n              console.log(response);\n              getProducts();\n              setLoading(false);\n            }\n\n            _context3.next = 15;\n            break;\n\n          case 10:\n            _context3.prev = 10;\n            _context3.t0 = _context3[\"catch\"](3);\n            console.log(_context3.t0);\n            setLoading(false);\n            alert(\"failed to delete\");\n\n          case 15:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, [[3, 10]], Promise);\n  };\n\n  if (loading) {\n    return __jsx(Loading, null);\n  } else if (!customer || !Boolean(customer.is_admin)) {\n    if (true) {\n      router.push('/');\n    }\n  }\n\n  return __jsx(\"div\", {\n    className: css.admin\n  }, __jsx(\"h1\", {\n    className: css.admin_header\n  }, \"Admin Page\"), __jsx(\"div\", {\n    className: css.add_product\n  }, __jsx(\"button\", {\n    onClick: addButton\n  }, buttonText), __jsx(\"div\", null, __jsx(\"form\", _defineProperty({\n    className: css.show\n  }, \"className\", \"admin_form\"), __jsx(\"label\", {\n    \"for\": \"name\"\n  }, \"Name:\"), __jsx(\"input\", {\n    type: \"text\",\n    id: \"name\",\n    name: \"name\",\n    placeholder: \"product name\",\n    value: name,\n    onChange: handleChange\n  }), __jsx(\"label\", {\n    \"for\": \"price\"\n  }, \"Price:\"), __jsx(\"input\", {\n    type: \"text\",\n    id: \"price\",\n    name: \"price\",\n    placeholder: \"product price\",\n    value: price,\n    onChange: handleChange\n  }), __jsx(\"label\", {\n    \"for\": \"category\"\n  }, \"category:\"), __jsx(\"select\", {\n    id: \"category\",\n    name: \"category\",\n    onChange: handleChange\n  }, __jsx(\"option\", {\n    value: \"antibiotics\",\n    selected: true\n  }, \"Antibiotics\"), __jsx(\"option\", {\n    value: \"antidiabetics\"\n  }, \"Antidiabetics\"), __jsx(\"option\", {\n    value: \"antimaleria\"\n  }, \"Antimaleria\")), __jsx(\"br\", null), __jsx(\"label\", {\n    \"for\": \"image\"\n  }, \"Upload image:\"), __jsx(\"input\", {\n    type: \"file\",\n    id: \"image\",\n    name: \"image\",\n    placeholder: \"Select Image\",\n    onChange: handleChange\n  }), __jsx(\"label\", {\n    \"for\": \"description\"\n  }, \"Description:\"), __jsx(\"textarea\", {\n    type: \"text\",\n    id: \"description\",\n    name: \"description\",\n    placeholder: \"Product Description\",\n    value: description,\n    onChange: handleChange\n  }), __jsx(\"br\", null), __jsx(\"button\", {\n    onClick: handleSubmit\n  }, \"Submit\")))), __jsx(\"table\", {\n    className: css.table\n  }, __jsx(\"thead\", null, __jsx(\"tr\", null, __jsx(\"th\", null, __jsx(\"div\", null, \"Product\")), __jsx(\"th\", null, __jsx(\"div\", null, \"Category\")), __jsx(\"th\", null, __jsx(\"div\", null, \"Price\")), __jsx(\"th\", null, __jsx(\"div\", null, \"In stock\")), __jsx(\"th\", null, __jsx(\"div\", null, \"Action\")))), __jsx(\"tbody\", null, products.map(function (item) {\n    return __jsx(\"tr\", {\n      key: item.product_id\n    }, __jsx(\"td\", null, __jsx(\"div\", null, __jsx(\"img\", {\n      src: \"http://localhost:4000/\" + item.image_url,\n      alt: \"\",\n      width: \"40em\"\n    }), __jsx(\"br\", null), __jsx(Link, {\n      href: \"/products/[id]\",\n      as: \"/products/\".concat(item.id)\n    }, __jsx(\"a\", null, \" \", item.name)))), __jsx(\"td\", null, __jsx(\"strong\", null, item.category)), __jsx(\"td\", null, __jsx(\"strong\", null, \"\\u20A6 \", item.price)), __jsx(\"td\", null, item.quantity), __jsx(\"td\", null, __jsx(\"button\", null, __jsx(Link, {\n      href: \"/editproduct/[id]\",\n      as: \"/editproduct/\".concat(item.product_id)\n    }, \"Edit\")), __jsx(\"button\", {\n      onClick: function onClick() {\n        handleDelete(item.product_id);\n      }\n    }, \"Delete\")));\n  }))));\n};\n\nexport default Admin;","map":null,"metadata":{},"sourceType":"module"}